# üéµ Music Search Service (Java + gRPC + Elasticsearch)

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–µ—Ä–≤–∏—Å –ø–æ–∏—Å–∫–∞ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π ‚Äî **—Ç—Ä–µ–∫–æ–≤, –∞—Ä—Ç–∏—Å—Ç–æ–≤ –∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤**, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —è–∑—ã–∫–µ **Java**.  
–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É **gRPC**, –∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–æ–∏—Å–∫–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Elasticsearch**.

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç:
- –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º —Å—É—â–Ω–æ—Å—Ç—è–º;
- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö;
- –º–∞—Å—Å–æ–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö (Bulk Upsert);
- –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ XML-—Ñ–∞–π–ª–æ–≤;
- –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ gRPC.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
elastic_and_java/
‚îú‚îÄ‚îÄ search-api/        # gRPC API (protobuf-–∫–æ–Ω—Ç—Ä–∞–∫—Ç)
‚îú‚îÄ‚îÄ search-service/    # gRPC —Å–µ—Ä–≤–µ—Ä + Elasticsearch
‚îú‚îÄ‚îÄ search-client/     # gRPC –∫–ª–∏–µ–Ω—Ç (CLI)
‚îú‚îÄ‚îÄ data/              # XML-—Ñ–∞–π–ª—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ infra/             # Docker Compose (Elasticsearch + Kibana)
‚îî‚îÄ‚îÄ README.md
```

---

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Java 21+
- Spring Boot
- gRPC
- Protocol Buffers
- Elasticsearch 8.x
- Docker / Docker Compose
- Maven

---

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –ó–∞–ø—É—Å–∫ Elasticsearch –∏ Kibana

–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ `infra`:

```bash
cd infra
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

```bash
docker compose up -d
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤:
- Elasticsearch: http://localhost:9200
- Kibana: http://localhost:5601
- –ö–æ–Ω—Å–æ–ª—å ES: http://localhost:5601/app/dev_tools#/console

---

### 2. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```bash
mvn -DskipTests clean install
```

–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
- –≥–µ–Ω–µ—Ä–∞—Ü–∏—é gRPC-–∫–æ–¥–∞;
- —Å–±–æ—Ä–∫—É –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞ (`search-api`, `search-service`, `search-client`).

---

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (search-service)

```bash
cd search-service
mvn spring-boot:run
```

–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
gRPC Server started, listening on port 9090
```

---

### 4. –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Elasticsearch (—á–µ—Ä–µ–∑ gRPC)

–ò–º–ø–æ—Ä—Ç –∞—Ä—Ç–∏—Å—Ç–æ–≤:

```bash
cd search-client
mvn -DskipTests exec:java "-Dexec.args=import-artists ../data/artists.xml localhost 9090"
```

–ò–º–ø–æ—Ä—Ç —Ç—Ä–µ–∫–æ–≤:

```bash
mvn -DskipTests exec:java "-Dexec.args=import-tracks ../data/tracks.xml localhost 9090"
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:

```
=== BULK UPSERT ===
total=10 success=10 failed=0
=== DONE ===
```

---

### 5. –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö (—á–µ—Ä–µ–∑ gRPC –∫–ª–∏–µ–Ω—Ç)

–ü—Ä–∏–º–µ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞:

```bash
mvn -DskipTests exec:java "-Dexec.args=metallica 10 ARTIST,TRACK localhost 9090"
```

–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:

```
ARTIST | Metallica | US | score=2.408
TRACK  | Enter Sandman | Metallica | score=1.047
TRACK  | Nothing Else Matters | Metallica | score=1.047
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é –≤ Elasticsearch

–ß–µ—Ä–µ–∑ Kibana ‚Üí Dev Tools:

```http
GET artists/_search
{
  "query": { "match_all": {} }
}
```

```http
GET tracks/_search
{
  "query": { "match_all": {} }
}
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–µ—Ä–≤–∏—Å –ø–æ–∏—Å–∫–∞ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (—Ç—Ä–µ–∫–æ–≤, –∞—Ä—Ç–∏—Å—Ç–æ–≤, –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤) –Ω–∞ Java —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º gRPC –∏ Elasticsearch.  
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –º–æ–¥—É–ª—å–Ω–∞—è –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä, –∞ —Ç–∞–∫–∂–µ –º–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:
> ¬´–°–µ—Ä–≤–∏—Å –ø–æ–∏—Å–∫–∞ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤, –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤, –∞—Ä—Ç–∏—Å—Ç–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Java, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ë–î Elasticsearch, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞, –æ–±—Ä–∞—â–∞—é—â–µ–≥–æ—Å—è –∫ —Å–µ—Ä–≤–∏—Å—É –ø–æ gRPC¬ª.
